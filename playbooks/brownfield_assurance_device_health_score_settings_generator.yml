---
# Playbook to generate YAML configurations for Assurance Device Health Score Settings
# This playbook demonstrates various use cases for the brownfield_assurance_device_health_score_settings_playbook_generator module

- name: Brownfield Assurance Device Health Score Settings Playbook Generator Examples
  hosts: localhost
  vars_files:
    - "credentials.yml"
  connection: local
  gather_facts: false
  tasks:
    # Example 1: Generate all device health score settings configurations
    - name: Generate complete brownfield configuration for all device families and KPI settings
      cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
        dnac_host: "{{ dnac_host }}"
        dnac_username: "{{ dnac_username }}"
        dnac_password: "{{ dnac_password }}"
        dnac_verify: "{{ dnac_verify }}"
        dnac_port: "{{ dnac_port }}"
        dnac_version: "{{ dnac_version }}"
        dnac_debug: "{{ dnac_debug }}"
        dnac_log: true
        dnac_log_level: DEBUG
        dnac_api_task_timeout: 1000
        dnac_task_poll_interval: 1
        state: merged
        config_verify: true
        config:
          - generate_all_configurations: true
            file_path: "/Users/mekandar/Desktop/complete_device_health_score_settings.yml"
      register: complete_config_result

    - name: Display complete configuration generation results
      debug:
        msg: 
          - "Configuration file generated at: {{ complete_config_result.response.file_path | default('No file generated') }}"
          - "Total device families processed: {{ complete_config_result.response.operation_summary.total_device_families_processed | default(0) }}"
          - "Total KPIs processed: {{ complete_config_result.response.operation_summary.total_kpis_processed | default(0) }}"
          - "Task status: {{ 'Success' if not complete_config_result.failed else 'Failed' }}"

    # Example 2: Generate configurations for specific device families
    - name: Generate configuration for specific device families (Access Points and Routers)
      cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
        dnac_host: "{{ dnac_host }}"
        dnac_username: "{{ dnac_username }}"
        dnac_password: "{{ dnac_password }}"
        dnac_verify: "{{ dnac_verify }}"
        dnac_port: "{{ dnac_port }}"
        dnac_version: "{{ dnac_version }}"
        dnac_debug: "{{ dnac_debug }}"
        dnac_log: true
        dnac_log_level: DEBUG
        dnac_api_task_timeout: 1000
        dnac_task_poll_interval: 1
        state: merged
        config_verify: true
        config: 
          - component_specific_filters:
              device_health_score_settings:
                device_families:
                  - "UNIFIED_AP"
                  - "ROUTER"
      register: specific_families_result

    - name: Display specific families configuration results
      debug:
        msg: 
          - "Configuration file generated at: {{ specific_families_result.response.file_path | default('No file generated') }}"
          - "Device families with complete success: {{ specific_families_result.response.operation_summary.device_families_with_complete_success | default([]) }}"
          - "Task status: {{ 'Success' if not specific_families_result.failed else 'Failed' }}"

    # Example 3: Generate configurations for specific KPIs across all device families
    - name: Generate configuration for specific KPI metrics
      cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
        dnac_host: "{{ dnac_host }}"
        dnac_username: "{{ dnac_username }}"
        dnac_password: "{{ dnac_password }}"
        dnac_verify: "{{ dnac_verify }}"
        dnac_port: "{{ dnac_port }}"
        dnac_version: "{{ dnac_version }}"
        dnac_debug: "{{ dnac_debug }}"
        dnac_log: true
        dnac_log_level: DEBUG
        dnac_api_task_timeout: 1000
        dnac_task_poll_interval: 1
        state: merged
        config_verify: true
        config: 
          - component_specific_filters:
              device_health_score_settings:
                kpi_names:
                  - "CPU Utilization"
                  - "Memory Utilization"
                  - "Link Error"
      register: specific_kpis_result

    - name: Display specific KPIs configuration results
      debug:
        msg: 
          - "Configuration file generated at: {{ specific_kpis_result.response.file_path | default('No file generated') }}"
          - "Total successful operations: {{ specific_kpis_result.response.operation_summary.total_successful_operations | default(0) }}"
          - "Task status: {{ 'Success' if not specific_kpis_result.failed else 'Failed' }}"

#     # Example 4: Generate configurations for specific device families and KPIs
#     - name: Generate configuration for switches with specific KPIs
#       cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
#         dnac_host: "{{ dnac_host }}"
#         dnac_port: "{{ dnac_port }}"
#         dnac_username: "{{ dnac_username }}"
#         dnac_password: "{{ dnac_password }}"
#         dnac_verify: "{{ dnac_verify }}"
#         dnac_debug: "{{ dnac_debug }}"
#         dnac_version: "{{ dnac_version }}"
#         state: merged
#         config_verify: false
#         config:
#           - file_path: "/tmp/switch_specific_kpi_settings.yml"
#             component_specific_filters:
#               device_health_score_settings:
#                 device_families:
#                   - "SWITCH_AND_HUB"
#                 kpi_names:
#                   - "Interface Utilization"
#                   - "CPU Utilization"
#       register: switch_specific_result

#     - name: Display switch-specific configuration results
#       debug:
#         msg: 
#           - "Configuration file generated at: {{ switch_specific_result.response.file_path }}"
#           - "Device families processed: {{ switch_specific_result.response.operation_summary.device_families_with_complete_success }}"

#     # Example 5: Generate configuration for specific device family (WIRELESS_CONTROLLER)
#     - name: Generate configuration for WIRELESS_CONTROLLER device family only
#       cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
#         dnac_host: "{{ dnac_host }}"
#         dnac_port: "{{ dnac_port }}"
#         dnac_username: "{{ dnac_username }}"
#         dnac_password: "{{ dnac_password }}"
#         dnac_verify: "{{ dnac_verify }}"
#         dnac_debug: "{{ dnac_debug }}"
#         dnac_version: "{{ dnac_version }}"
#         state: merged
#         config_verify: false
#         config:
#           - file_path: "/tmp/wireless_controller_only_settings.yml"
#             component_specific_filters:
#               device_health_score_settings:
#                 device_families:
#                   - "WIRELESS_CONTROLLER"
#       register: wireless_controller_result

#     - name: Display wireless controller configuration results
#       debug:
#         msg: 
#           - "Configuration file generated at: {{ wireless_controller_result.response.file_path }}"
#           - "Device families with complete success: {{ wireless_controller_result.response.operation_summary.device_families_with_complete_success }}"

#     # Example 6: Generate configuration for ROUTER device family specifically 
#     - name: Generate configuration for ROUTER device family only
#       cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
#         dnac_host: "{{ dnac_host }}"
#         dnac_port: "{{ dnac_port }}"
#         dnac_username: "{{ dnac_username }}"
#         dnac_password: "{{ dnac_password }}"
#         dnac_verify: "{{ dnac_verify }}"
#         dnac_debug: "{{ dnac_debug }}"
#         dnac_version: "{{ dnac_version }}"
#         state: merged
#         config_verify: false
#         config:
#           - file_path: "/tmp/router_only_settings.yml"
#             component_specific_filters:
#               device_health_score_settings:
#                 device_families:
#                   - "ROUTER"
#       register: router_result

#     - name: Display router configuration results
#       debug:
#         msg: 
#           - "Configuration file generated at: {{ router_result.response.file_path }}"
#           - "Router device family KPIs processed: {{ router_result.response.operation_summary.total_kpis_processed }}"

#     # Example 7: Error handling demonstration
#     - name: Demonstrate error handling for invalid device family
#       cisco.dnac.brownfield_assurance_device_health_score_settings_playbook_generator:
#         dnac_host: "{{ dnac_host }}"
#         dnac_port: "{{ dnac_port }}"
#         dnac_username: "{{ dnac_username }}"
#         dnac_password: "{{ dnac_password }}"
#         dnac_verify: "{{ dnac_verify }}"
#         dnac_debug: "{{ dnac_debug }}"
#         dnac_version: "{{ dnac_version }}"
#         state: merged
#         config_verify: false
#         config:
#           - file_path: "/tmp/error_demo_settings.yml"
#             component_specific_filters:
#               device_health_score_settings:
#                 device_families:
#                   - "INVALID_DEVICE_TYPE"
#       register: error_demo_result
#       ignore_errors: true

#     - name: Display error handling results
#       debug:
#         msg: 
#           - "Task failed as expected: {{ error_demo_result.failed | default(false) }}"
#           - "Error message: {{ error_demo_result.msg | default('No error') }}"
#       when: error_demo_result.failed | default(false)

#     # Summary task
#     - name: Display summary of all generated configurations
#       debug:
#         msg:
#           - "=== Brownfield Device Health Score Settings Generation Summary ==="
#           - "1. Complete configuration: {{ complete_config_result.response.file_path | default('Failed') }}"
#           - "2. AP/Router configuration: {{ specific_families_result.response.file_path | default('Failed') }}"
#           - "3. Specific KPI configuration: {{ specific_kpis_result.response.file_path | default('Failed') }}"
#           - "4. Switch-specific configuration: {{ switch_specific_result.response.file_path | default('Failed') }}"
#           - "5. Auto-filename configuration: {{ auto_filename_result.response.file_path | default('Failed') }}"
#           - "All generated files can be used with the 'assurance_device_health_score_settings_workflow_manager' module"

# # Additional playbook for applying the generated configurations
# - name: Apply Generated Device Health Score Settings Configuration
  # hosts: localhost
  # gather_facts: false
  # vars:
  #   # Use the generated configuration file
  #   generated_config_file: "/tmp/complete_device_health_score_settings.yml"
    
  # tasks:
  #   - name: Read generated configuration file
  #     include_vars:
  #       file: "{{ generated_config_file }}"
  #       name: device_health_config
  #     when: generated_config_file is file

  #   - name: Apply device health score settings from generated configuration
  #     cisco.dnac.assurance_device_health_score_settings_workflow_manager:
  #       dnac_host: "{{ dnac_host }}"
  #       dnac_port: "{{ dnac_port }}"
  #       dnac_username: "{{ dnac_username }}"
  #       dnac_password: "{{ dnac_password }}"
  #       dnac_verify: "{{ dnac_verify }}"
  #       dnac_debug: "{{ dnac_debug }}"
  #       dnac_version: "{{ dnac_version }}"
  #       state: merged
  #       config_verify: true
  #       config: "{{ device_health_config.config | default([]) }}"
  #     register: apply_result
  #     when: device_health_config is defined

  #   - name: Display application results
  #     debug:
  #       msg:
  #         - "Configuration applied successfully: {{ apply_result.changed | default(false) }}"
  #         - "Response: {{ apply_result.response | default('No response') }}"
  #     when: apply_result is defined